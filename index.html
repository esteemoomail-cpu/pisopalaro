<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>LUCKY 6 LOTTERY</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#060919;--card:rgba(12,17,50,.92);--card2:rgba(20,26,60,.85);
  --gold:#ffd700;--goldd:#c9a200;
  --txt:#eef;--sub:#6a73a0;--bdr:rgba(255,215,0,.1);
  --ok:#00e676;--gc:#007aff;--err:#ff3b3b;--warn:#ff9100;
  --r:12px
}
html{scroll-behavior:smooth}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--txt);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 30% -10%,rgba(255,215,0,.06),transparent 60%),radial-gradient(ellipse at 70% 110%,rgba(0,122,255,.04),transparent 55%);pointer-events:none}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PUBLIC PAGE STYLES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.w{max-width:860px;margin:0 auto;padding:14px;position:relative;z-index:1}
header{text-align:center;padding:30px 0 8px}
.logo{font-size:clamp(2rem,7vw,3.3rem);font-weight:900;background:linear-gradient(135deg,var(--goldd),var(--gold),#fff8c4,var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:4px}
.logo span{display:block;font-size:.38em;letter-spacing:12px;font-weight:300;-webkit-text-fill-color:var(--sub)}
.tag{color:var(--sub);font-size:.85rem;margin-top:4px;letter-spacing:1px}
.pill{display:inline-block;margin-top:12px;padding:7px 24px;background:linear-gradient(135deg,var(--goldd),var(--gold));color:#000;border-radius:50px;font-weight:800;font-size:.95rem}
.range{margin-top:6px;color:var(--sub);font-size:.75rem;font-family:'JetBrains Mono',monospace;letter-spacing:2px}

.info-bar{background:var(--card);border:1px solid var(--bdr);border-radius:16px;padding:20px 24px;backdrop-filter:blur(10px);margin:22px 0}
.info-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px}
.date-box{display:flex;align-items:center;gap:10px}
.date-icon{width:42px;height:42px;background:linear-gradient(135deg,rgba(255,215,0,.12),rgba(255,215,0,.04));border:1px solid rgba(255,215,0,.15);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0}
.date-label{font-size:.65rem;color:var(--sub);text-transform:uppercase;letter-spacing:2px;margin-bottom:2px}
.date-value{font-size:1.05rem;font-weight:700;font-family:'JetBrains Mono',monospace;color:var(--gold)}
.avail-label{font-size:.65rem;color:var(--sub);text-transform:uppercase;letter-spacing:2px;text-align:right}
.avail-status{font-size:.82rem;font-weight:600;margin-top:2px;text-align:right}
.avail-status.high{color:var(--ok)}.avail-status.mid{color:var(--warn)}.avail-status.low{color:var(--err)}

.progress-wrap{position:relative}
.progress-track{width:100%;height:14px;background:rgba(255,255,255,.06);border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,.05)}
.progress-fill{height:100%;border-radius:10px;background:linear-gradient(90deg,var(--ok),#69f0ae);transition:width 1.5s cubic-bezier(.4,0,.2,1);position:relative;min-width:0}
.progress-fill.mid{background:linear-gradient(90deg,var(--warn),#ffcc02)}
.progress-fill.low{background:linear-gradient(90deg,var(--err),#ff6b6b)}
.progress-fill::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent);animation:shimmer 2s infinite}
@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.progress-dots{display:flex;justify-content:space-between;margin-top:6px;padding:0 2px}
.progress-dots span{width:1px;height:6px;background:rgba(255,255,255,.1)}

.conn{display:flex;align-items:center;justify-content:center;gap:8px;margin:16px 0 8px;padding:10px;border-radius:var(--r);font-size:.8rem;font-weight:600;transition:.3s}
.conn.checking{background:rgba(255,255,255,.05);color:var(--sub);border:1px solid rgba(255,255,255,.08)}
.conn.online{background:rgba(0,230,118,.08);color:var(--ok);border:1px solid rgba(0,230,118,.15)}
.conn.offline{background:rgba(255,59,59,.08);color:var(--err);border:1px solid rgba(255,59,59,.15)}
.conn .dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.conn.checking .dot{background:var(--sub);animation:pulse 1s infinite}
.conn.online .dot{background:var(--ok)}
.conn.offline .dot{background:var(--err)}
@keyframes pulse{0%,100%{opacity:.3}50%{opacity:1}}

.card{background:var(--card);border:1px solid var(--bdr);border-radius:16px;padding:24px;backdrop-filter:blur(10px);margin-bottom:22px}
.steps{display:flex;justify-content:center;align-items:center;margin-bottom:22px}
.stp{display:flex;align-items:center;gap:5px;padding:7px 10px;font-size:.76rem;font-weight:600;color:var(--sub);transition:.3s}
.stp .n{width:25px;height:25px;border-radius:50%;background:rgba(255,255,255,.07);display:flex;align-items:center;justify-content:center;font-size:.73rem;font-weight:700;transition:.3s}
.stp.on{color:var(--gold)}.stp.on .n{background:var(--gold);color:#000}
.stp.ok{color:var(--ok)}.stp.ok .n{background:var(--ok);color:#fff}
.sln{width:28px;height:2px;background:rgba(255,255,255,.07);transition:.3s}.sln.on{background:var(--gold)}

.ct{font-size:1.05rem;font-weight:700;margin-bottom:18px;display:flex;align-items:center;gap:7px}
.fg{margin-bottom:14px}
.fg label{display:block;font-size:.7rem;font-weight:600;color:var(--sub);margin-bottom:5px;text-transform:uppercase;letter-spacing:2px}
.fg input,.fg textarea,.fg select{width:100%;padding:12px 13px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:10px;color:#fff;font-size:1rem;font-family:inherit;outline:none;transition:.3s}
.fg input:focus,.fg textarea:focus,.fg select:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(255,215,0,.08)}
.fg input::placeholder{color:rgba(255,255,255,.18)}
.fg small{display:block;margin-top:4px;font-size:.68rem;color:var(--sub)}
.fg .field-err{color:var(--err);font-size:.7rem;margin-top:4px;display:none}
.fr{display:grid;grid-template-columns:1fr 1fr;gap:12px}

.tot{background:linear-gradient(135deg,rgba(255,215,0,.08),rgba(255,215,0,.02));border:1px dashed rgba(255,215,0,.2);border-radius:var(--r);padding:14px;text-align:center;margin:14px 0}
.tot .tl{font-size:.66rem;color:var(--sub);text-transform:uppercase;letter-spacing:2px;margin-bottom:3px}
.tot .tv{font-size:1.9rem;font-weight:900;color:var(--gold);font-family:'JetBrains Mono',monospace}

.gc{background:linear-gradient(135deg,rgba(0,122,255,.1),rgba(0,122,255,.03));border:1px solid rgba(0,122,255,.18);border-radius:var(--r);padding:18px;margin:14px 0}
.gc-h{display:flex;align-items:center;gap:7px;margin-bottom:10px;font-weight:700}
.gc-b{background:var(--gc);color:#fff;padding:4px 11px;border-radius:6px;font-weight:800;font-size:.8rem}
.gc-num{font-family:'JetBrains Mono',monospace;font-size:1.2rem;font-weight:700;color:#64b5f6;background:rgba(0,122,255,.12);padding:9px 16px;border-radius:8px;display:inline-block;margin:5px 0;cursor:pointer;user-select:all;border:1px dashed rgba(100,181,246,.3);transition:.2s}
.gc-num:hover{background:rgba(0,122,255,.2)}

.btn{width:100%;padding:13px;border:none;border-radius:var(--r);font-size:.9rem;font-weight:700;font-family:inherit;cursor:pointer;transition:.25s;text-transform:uppercase;letter-spacing:2px}
.b1{background:linear-gradient(135deg,var(--goldd),var(--gold));color:#000;box-shadow:0 4px 24px rgba(255,215,0,.2)}
.b1:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 6px 32px rgba(255,215,0,.3)}
.b1:disabled{opacity:.4;cursor:not-allowed;transform:none}
.b2{background:rgba(255,255,255,.06);color:#fff;border:1px solid rgba(255,255,255,.1);margin-top:10px}
.b2:hover{background:rgba(255,255,255,.1)}

.receipt{background:var(--card);border:1px solid var(--bdr);border-radius:16px;padding:24px;backdrop-filter:blur(10px)}
.rh{text-align:center;padding-bottom:16px;border-bottom:1px dashed var(--bdr);margin-bottom:14px}
.rh .ic{width:56px;height:56px;background:var(--ok);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.7rem;margin:0 auto 10px;animation:pop .4s}
@keyframes pop{0%{transform:scale(0) rotate(-20deg)}60%{transform:scale(1.15) rotate(5deg)}100%{transform:scale(1)}}
.rd{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px;padding-bottom:14px;border-bottom:1px dashed var(--bdr)}
.ri .rl{color:var(--sub);font-size:.63rem;text-transform:uppercase;letter-spacing:1.5px}
.ri .rv{font-weight:600;margin-top:2px;font-size:.88rem;word-break:break-all}
.ubadge{display:inline-flex;align-items:center;gap:4px;background:rgba(0,230,118,.1);border:1px solid rgba(0,230,118,.2);color:var(--ok);padding:4px 13px;border-radius:20px;font-size:.7rem;font-weight:700;letter-spacing:1px;margin:8px auto;text-transform:uppercase}
.nt{font-weight:700;font-size:.95rem;margin-bottom:8px;display:flex;align-items:center;gap:6px}
.nbox{max-height:480px;overflow-y:auto;padding:11px;background:rgba(0,0,0,.4);border-radius:10px;border:1px solid rgba(255,215,0,.06);margin:6px 0}
.ngrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(98px,1fr));gap:4px}
.ni{font-family:'JetBrains Mono',monospace;font-size:.88rem;font-weight:700;padding:7px 3px;background:linear-gradient(135deg,rgba(255,215,0,.06),rgba(255,215,0,.02));border:1px solid rgba(255,215,0,.1);border-radius:6px;text-align:center;color:var(--gold);letter-spacing:3px}
.acts{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:14px}
.acts .btn{padding:9px;font-size:.7rem;letter-spacing:1.5px}

.ov{display:none;position:fixed;inset:0;background:rgba(6,9,25,.95);z-index:9999;justify-content:center;align-items:center;flex-direction:column;text-align:center;padding:20px}
.ov.on{display:flex}
.sp{width:50px;height:50px;border:4px solid rgba(255,215,0,.12);border-top-color:var(--gold);border-radius:50%;animation:spin .7s linear infinite;margin-bottom:14px}
@keyframes spin{to{transform:rotate(360deg)}}
.ov-t{color:var(--gold);font-weight:600;font-size:.9rem;letter-spacing:1px;line-height:1.8}
.ov-s{color:var(--sub);font-size:.78rem;margin-top:6px;line-height:1.6}
.rb{width:240px;height:4px;background:rgba(255,255,255,.08);border-radius:3px;margin-top:14px;overflow:hidden;display:none}
.rb .fl{height:100%;background:var(--gold);border-radius:3px}

.toast{position:fixed;top:14px;right:14px;padding:12px 20px;border-radius:10px;font-weight:600;font-size:.85rem;z-index:10001;transform:translateX(150%);transition:transform .3s ease;max-width:400px;line-height:1.5}
.toast.on{transform:translateX(0)}
.toast.err{background:var(--err);color:#fff}
.toast.suc{background:var(--ok);color:#000}
.toast.warn{background:var(--warn);color:#000}

.nbox::-webkit-scrollbar{width:5px}
.nbox::-webkit-scrollbar-track{background:rgba(255,255,255,.02)}
.nbox::-webkit-scrollbar-thumb{background:rgba(255,215,0,.2);border-radius:3px}

.hide{display:none!important}

.err-panel{background:linear-gradient(135deg,rgba(255,59,59,.1),rgba(255,59,59,.03));border:1px solid rgba(255,59,59,.2);border-radius:var(--r);padding:18px;margin:14px 0;line-height:1.8;font-size:.85rem}
.err-panel h3{color:var(--err);margin-bottom:8px;font-size:.95rem}
.err-panel code{background:rgba(0,0,0,.4);padding:2px 7px;border-radius:4px;font-family:'JetBrains Mono',monospace;font-size:.78rem;color:#ff9999}
.err-panel .retry-btn{display:inline-block;margin-top:10px;padding:8px 20px;background:var(--err);color:#fff;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-family:inherit;font-size:.82rem}

footer{text-align:center;padding:24px 0;color:var(--sub);font-size:.68rem;line-height:2}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN PANEL STYLES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.login-wrap{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px}
.login-box{background:var(--card);border:1px solid var(--bdr);border-radius:20px;padding:40px 32px;width:100%;max-width:420px;backdrop-filter:blur(10px);text-align:center}
.login-box h1{font-size:1.6rem;margin-bottom:4px;background:linear-gradient(135deg,var(--goldd),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.login-box .lsub{color:var(--sub);font-size:.82rem;margin-bottom:28px}

.admin{display:none;min-height:100vh}
.topbar{background:var(--card);border-bottom:1px solid var(--bdr);padding:12px 24px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;backdrop-filter:blur(10px)}
.topbar h1{font-size:1.1rem;background:linear-gradient(135deg,var(--goldd),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.topbar .user{display:flex;align-items:center;gap:10px;font-size:.82rem;color:var(--sub)}
.topbar .logout{padding:6px 14px;background:rgba(255,59,59,.1);border:1px solid rgba(255,59,59,.2);color:var(--err);border-radius:8px;font-size:.75rem;font-weight:700;cursor:pointer;font-family:inherit;text-transform:uppercase;letter-spacing:1px;transition:.2s}
.topbar .logout:hover{background:rgba(255,59,59,.2)}

.admain{display:flex;min-height:calc(100vh - 56px)}
.sidebar{width:220px;background:var(--card);border-right:1px solid var(--bdr);padding:16px 0;flex-shrink:0;position:sticky;top:56px;height:calc(100vh - 56px);overflow-y:auto}
.nav-item{display:flex;align-items:center;gap:10px;padding:11px 20px;font-size:.82rem;font-weight:500;color:var(--sub);cursor:pointer;transition:.2s;border-left:3px solid transparent}
.nav-item:hover{background:rgba(255,215,0,.04);color:var(--txt)}
.nav-item.active{background:rgba(255,215,0,.06);color:var(--gold);border-left-color:var(--gold);font-weight:700}
.nav-sep{height:1px;background:var(--bdr);margin:10px 16px}

.content{flex:1;padding:24px;overflow-y:auto}
.page{display:none}.page.active{display:block}
.page-title{font-size:1.4rem;font-weight:800;margin-bottom:6px}
.page-sub{color:var(--sub);font-size:.82rem;margin-bottom:24px}

.stats{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:14px;margin-bottom:24px}
.stat{background:var(--card2);border:1px solid var(--bdr);border-radius:14px;padding:18px;transition:.2s}
.stat:hover{border-color:rgba(255,215,0,.2);transform:translateY(-1px)}
.stat .sl{font-size:.65rem;color:var(--sub);text-transform:uppercase;letter-spacing:2px;margin-bottom:6px}
.stat .sv{font-size:1.6rem;font-weight:800;font-family:'JetBrains Mono',monospace}
.stat .sc{font-size:.7rem;margin-top:4px}
.stat.gold .sv{color:var(--gold)}.stat.green .sv{color:var(--ok)}.stat.blue .sv{color:var(--gc)}.stat.red .sv{color:var(--err)}

.tbl-wrap{background:var(--card2);border:1px solid var(--bdr);border-radius:14px;overflow:hidden;margin-bottom:20px}
.tbl-head{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid var(--bdr);flex-wrap:wrap;gap:10px}
.tbl-head h3{font-size:.95rem}
.tbl-actions{display:flex;gap:8px;align-items:center}
.btn-sm{padding:7px 14px;border:none;border-radius:8px;font-size:.75rem;font-weight:700;cursor:pointer;font-family:inherit;transition:.2s;text-transform:uppercase;letter-spacing:1px}
.btn-gold{background:linear-gradient(135deg,var(--goldd),var(--gold));color:#000}
.btn-blue{background:rgba(0,122,255,.15);border:1px solid rgba(0,122,255,.2);color:#64b5f6}
.btn-blue:hover{background:rgba(0,122,255,.25)}
.btn-red{background:rgba(255,59,59,.12);border:1px solid rgba(255,59,59,.2);color:var(--err)}
.btn-red:hover{background:rgba(255,59,59,.2)}
.btn-green{background:rgba(0,230,118,.12);border:1px solid rgba(0,230,118,.2);color:var(--ok)}
.btn-green:hover{background:rgba(0,230,118,.2)}

table{width:100%;border-collapse:collapse}
th{padding:10px 14px;text-align:left;font-size:.68rem;text-transform:uppercase;letter-spacing:2px;color:var(--sub);border-bottom:1px solid var(--bdr);background:rgba(0,0,0,.2);white-space:nowrap}
td{padding:10px 14px;border-bottom:1px solid rgba(255,255,255,.03);font-size:.82rem;white-space:nowrap}
tr:hover td{background:rgba(255,215,0,.02)}
.badge{display:inline-block;padding:3px 10px;border-radius:20px;font-size:.68rem;font-weight:700;text-transform:uppercase;letter-spacing:1px}
.badge.ok{background:rgba(0,230,118,.1);color:var(--ok)}.badge.fail{background:rgba(255,59,59,.1);color:var(--err)}.badge.del{background:rgba(255,145,0,.1);color:var(--warn)}
.mono{font-family:'JetBrains Mono',monospace;letter-spacing:2px;color:var(--gold)}
.tbl-empty{padding:40px;text-align:center;color:var(--sub);font-size:.88rem}
.pagination{display:flex;align-items:center;justify-content:center;gap:8px;padding:14px;border-top:1px solid var(--bdr)}
.pg-btn{padding:6px 12px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);border-radius:6px;color:var(--txt);font-size:.78rem;cursor:pointer;font-family:inherit;transition:.2s}
.pg-btn:hover{background:rgba(255,215,0,.08);border-color:var(--gold)}
.pg-btn:disabled{opacity:.3;cursor:not-allowed}
.pg-btn.active{background:var(--gold);color:#000;font-weight:700;border-color:var(--gold)}
.pg-info{font-size:.75rem;color:var(--sub)}

.settings-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.setting-group{background:var(--card2);border:1px solid var(--bdr);border-radius:14px;padding:20px;margin-bottom:16px}
.setting-group h3{font-size:.9rem;margin-bottom:14px;display:flex;align-items:center;gap:8px}
.fg textarea{resize:vertical;min-height:80px}
.fg select{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%236a73a0'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center}

.tool-card{background:var(--card2);border:1px solid var(--bdr);border-radius:14px;padding:20px;margin-bottom:16px}
.tool-card h3{font-size:.9rem;margin-bottom:12px;display:flex;align-items:center;gap:8px}
.tool-row{display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap}
.tool-row .fg{flex:1;min-width:160px;margin-bottom:0}

.bar-track{width:100%;height:8px;background:rgba(255,255,255,.06);border-radius:6px;overflow:hidden;margin-top:8px}
.bar-fill{height:100%;border-radius:6px;transition:width 1s;background:linear-gradient(90deg,var(--ok),#69f0ae)}
.bar-fill.mid{background:linear-gradient(90deg,var(--warn),#ffcc02)}
.bar-fill.low{background:linear-gradient(90deg,var(--err),#ff6b6b)}

.feed{list-style:none}
.feed li{padding:10px 14px;border-bottom:1px solid rgba(255,255,255,.03);display:flex;align-items:center;gap:12px;font-size:.82rem}
.feed li:last-child{border-bottom:none}
.feed .dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.feed .dot.ok{background:var(--ok)}.feed .dot.fail{background:var(--err)}.feed .dot.del{background:var(--warn)}
.feed .time{color:var(--sub);font-size:.7rem;font-family:'JetBrains Mono',monospace;white-space:nowrap}

.confirm-modal{display:none;position:fixed;inset:0;background:rgba(6,9,25,.92);z-index:10000;justify-content:center;align-items:center;padding:20px}
.confirm-modal.on{display:flex}
.confirm-box{background:var(--card);border:1px solid var(--bdr);border-radius:16px;padding:28px;max-width:420px;width:100%;text-align:center}
.confirm-box h3{margin-bottom:8px;font-size:1.05rem}
.confirm-box p{color:var(--sub);font-size:.85rem;margin-bottom:20px;line-height:1.7}
.confirm-box code{background:rgba(0,0,0,.4);padding:2px 8px;border-radius:4px;font-family:'JetBrains Mono',monospace;color:var(--gold)}
.confirm-btns{display:flex;gap:10px;justify-content:center}
.confirm-btns .btn-sm{padding:10px 24px;font-size:.8rem}

::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:rgba(255,255,255,.02)}
::-webkit-scrollbar-thumb{background:rgba(255,215,0,.15);border-radius:3px}

@media(max-width:640px){
  .w{padding:10px}.info-bar{padding:16px}
  .info-top{flex-direction:column;align-items:flex-start;gap:12px}
  .avail-label,.avail-status{text-align:left}
  .fr{grid-template-columns:1fr}.card{padding:16px}
  .ngrid{grid-template-columns:repeat(auto-fill,minmax(82px,1fr))}
  .acts{grid-template-columns:1fr}.rd{grid-template-columns:1fr}
  .stp .stx{display:none}.stp{padding:7px 6px}
}
@media(max-width:768px){
  .sidebar{display:none}.admain{flex-direction:column}.content{padding:14px}
  .stats{grid-template-columns:repeat(2,1fr)}.settings-grid{grid-template-columns:1fr}
  .tbl-head{flex-direction:column;align-items:stretch}
  .tool-row{flex-direction:column}.tool-row .fg{min-width:100%}
  table{font-size:.75rem}th,td{padding:8px 10px}
  .mob-nav{display:flex!important;overflow-x:auto;gap:4px;padding:10px 14px;background:var(--card);border-bottom:1px solid var(--bdr)}
  .mob-nav .nav-item{border-left:none;border-bottom:3px solid transparent;white-space:nowrap;padding:8px 12px;font-size:.72rem}
  .mob-nav .nav-item.active{border-bottom-color:var(--gold);border-left:none}
}
@media(min-width:769px){.mob-nav{display:none!important}}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SHARED OVERLAYS
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="ov" id="ov">
  <div class="sp"></div>
  <div class="ov-t" id="ovT">Processing...</div>
  <div class="ov-s" id="ovS">Please wait</div>
  <div class="rb" id="rb"><div class="fl" id="rf"></div></div>
</div>
<div class="toast" id="toast"></div>
<div class="confirm-modal" id="confirmModal">
  <div class="confirm-box">
    <h3 id="confirmTitle">Confirm</h3>
    <p id="confirmMsg"></p>
    <div class="confirm-btns">
      <button class="btn-sm btn-red" id="confirmYes">Yes, Delete</button>
      <button class="btn-sm btn-blue" onclick="closeConfirm()">Cancel</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PUBLIC PAGE â€” LOTTERY
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="publicPage">
<div class="w">

<header>
  <div class="logo">ğŸ° LUCKY 6<span>LOTTERY</span></div>
  <p class="tag">Get your lucky 6-digit number â€” only â‚±1 each!</p>
  <div class="pill">â‚±1.00 PER NUMBER</div>
  <div class="range">000000 â€” 999999</div>
</header>

<div class="conn checking" id="connBar">
  <div class="dot"></div>
  <span id="connTxt">Checking server connection...</span>
</div>
<div id="errPanel" class="err-panel hide"><h3>âš ï¸ Connection Failed</h3><div id="errDetail"></div></div>

<div class="info-bar">
  <div class="info-top">
    <div class="date-box">
      <div class="date-icon">ğŸ“…</div>
      <div><div class="date-label">Today's Date</div><div class="date-value" id="dateToday">â€”</div></div>
    </div>
    <div><div class="avail-label">Availability</div><div class="avail-status high" id="availTxt">Loading...</div></div>
  </div>
  <div class="progress-wrap">
    <div class="progress-track"><div class="progress-fill" id="progressFill" style="width:100%"></div></div>
    <div class="progress-dots"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div>
  </div>
</div>

<div id="secB">
<div class="card">
  <div class="steps">
    <div class="stp on" id="i1"><div class="n">1</div><span class="stx">Details</span></div>
    <div class="sln" id="l1"></div>
    <div class="stp" id="i2"><div class="n">2</div><span class="stx">Payment</span></div>
    <div class="sln" id="l2"></div>
    <div class="stp" id="i3"><div class="n">3</div><span class="stx">Complete</span></div>
  </div>
  <div id="p1">
    <div class="ct">ğŸ“ Your Details</div>
    <div class="fr">
      <div class="fg"><label>Full Name</label><input id="fN" placeholder="e.g. Juan Dela Cruz" autocomplete="name"></div>
      <div class="fg"><label>Phone Number <span style="font-weight:400;text-transform:none;color:var(--sub)">(11 digits)</span></label><input id="fP" type="tel" maxlength="11" placeholder="e.g. 09171234567" autocomplete="tel"><div class="field-err" id="phoneErr">Phone number must be exactly 11 digits</div></div>
    </div>
    <div class="fg"><label>How Many Numbers? <span style="font-weight:400;text-transform:none;color:var(--sub)">(50 â€“ 10,000)</span></label><input id="fQ" type="number" min="50" max="10000" placeholder="Minimum 50 numbers"><small>Each = unique random 6-digit code (000000â€“999999). Min 50, max 10,000 per transaction.</small></div>
    <div class="tot"><div class="tl">Total Amount</div><div class="tv" id="dT">â‚± 0.00</div></div>
    <button class="btn b1" onclick="go2()">Continue to Payment â†’</button>
  </div>
  <div id="p2" class="hide">
    <div class="ct">ğŸ’³ GCash Payment</div>
    <div class="gc">
      <div class="gc-h"><div class="gc-b">GCash</div> Send Payment To:</div>
      <div style="line-height:2.2"><strong>Name:</strong> <span id="dN"></span><br><strong>Number:</strong><br><div class="gc-num" id="dP" onclick="cpGC()" title="Click to copy"></div><br><strong>Amount:</strong> <span style="color:var(--gold);font-weight:800;font-size:1.1rem" id="dA"></span></div>
    </div>
    <div class="fg"><label>GCash Reference Number</label><input id="fR" placeholder="Enter ref # from your GCash receipt" autocomplete="off"><small>The reference/transaction number shown after sending payment.</small></div>
    <button class="btn b1" id="buyBtn" onclick="submitPurchase()">âœ“ Confirm Purchase</button>
    <button class="btn b2" onclick="go1()">â† Go Back</button>
  </div>
</div>
</div>

<div id="secR" class="hide">
<div class="receipt">
  <div class="rh">
    <div class="ic">âœ“</div>
    <h2 style="font-size:1.3rem;margin-bottom:3px">Purchase Successful!</h2>
    <p style="color:var(--sub);font-size:.83rem">Your unique 6-digit lottery numbers are ready.</p>
    <div class="ubadge">ğŸ”’ Verified unique â€” zero duplicates â€” full 6 digits</div>
  </div>
  <div class="rd">
    <div class="ri"><div class="rl">Transaction ID</div><div class="rv" id="rI"></div></div>
    <div class="ri"><div class="rl">Date & Time</div><div class="rv" id="rD"></div></div>
    <div class="ri"><div class="rl">Name</div><div class="rv" id="rN"></div></div>
    <div class="ri"><div class="rl">Phone</div><div class="rv" id="rP"></div></div>
    <div class="ri"><div class="rl">Quantity</div><div class="rv" id="rQ"></div></div>
    <div class="ri"><div class="rl">Amount Paid</div><div class="rv" style="color:var(--gold)" id="rA"></div></div>
    <div class="ri"><div class="rl">GCash Ref</div><div class="rv" id="rR"></div></div>
  </div>
  <div class="nt">ğŸ° Your Numbers (<span id="rC">0</span>)</div>
  <div class="nbox"><div class="ngrid" id="nG"></div></div>
  <div class="acts">
    <button class="btn b2" onclick="cpA()">ğŸ“‹ Copy</button>
    <button class="btn b2" onclick="dlA()">â¬‡ Download</button>
    <button class="btn b2" onclick="prA()">ğŸ–¨ Print</button>
  </div>
  <button class="btn b1" style="margin-top:16px" onclick="again()">ğŸ° Buy More Numbers</button>
</div>
</div>

<footer>Â© 2024 Lucky 6 Lottery &bull; 000000â€“999999 &bull; â‚±1.00 each &bull; GCash only<br>All numbers guaranteed unique with full 6 digits including leading zeros.</footer>
</div>
</div><!-- /publicPage -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ADMIN PAGE â€” HIDDEN BY DEFAULT
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="adminPage" style="display:none">

<!-- Admin Login -->
<div id="adminLogin" class="login-wrap">
  <div class="login-box">
    <h1>ğŸ” LUCKY 6</h1>
    <div class="lsub">Admin Panel â€” Authorized Access Only</div>
    <div class="fg"><label>Username</label><input id="loginUser" placeholder="Enter username" autocomplete="username"></div>
    <div class="fg"><label>Password</label><input id="loginPass" type="password" placeholder="Enter password" autocomplete="current-password"></div>
    <button class="btn b1" id="loginBtn" onclick="doLogin()">ğŸ”‘ Sign In</button>
  </div>
</div>

<!-- Admin Panel -->
<div class="admin" id="adminPanel">
<div class="topbar">
  <h1>ğŸ° LUCKY 6 â€” Admin</h1>
  <div class="user"><span id="adminUser">admin</span><button class="logout" onclick="doLogout()">Logout</button></div>
</div>
<div class="mob-nav">
  <div class="nav-item active" onclick="goPage('dashboard')">ğŸ“Š Dashboard</div>
  <div class="nav-item" onclick="goPage('transactions')">ğŸ“‹ TX</div>
  <div class="nav-item" onclick="goPage('numbers')">ğŸ”¢ Numbers</div>
  <div class="nav-item" onclick="goPage('search')">ğŸ” Search</div>
  <div class="nav-item" onclick="goPage('tools')">ğŸ”§ Tools</div>
  <div class="nav-item" onclick="goPage('settings')">âš™ï¸ Settings</div>
</div>
<div class="admain">
<div class="sidebar">
  <div class="nav-item active" data-page="dashboard" onclick="goPage('dashboard')">ğŸ“Š <span>Dashboard</span></div>
  <div class="nav-item" data-page="transactions" onclick="goPage('transactions')">ğŸ“‹ <span>Transactions</span></div>
  <div class="nav-item" data-page="numbers" onclick="goPage('numbers')">ğŸ”¢ <span>Sold Numbers</span></div>
  <div class="nav-sep"></div>
  <div class="nav-item" data-page="search" onclick="goPage('search')">ğŸ” <span>Search</span></div>
  <div class="nav-item" data-page="tools" onclick="goPage('tools')">ğŸ”§ <span>Tools</span></div>
  <div class="nav-sep"></div>
  <div class="nav-item" data-page="settings" onclick="goPage('settings')">âš™ï¸ <span>Settings</span></div>
</div>
<div class="content">

<!-- Dashboard -->
<div class="page active" id="pg-dashboard">
  <div class="page-title">Dashboard</div>
  <div class="page-sub">Real-time overview of Lucky 6 Lottery</div>
  <div class="stats">
    <div class="stat gold"><div class="sl">Total Sold</div><div class="sv" id="dsSold">â€”</div><div class="bar-track"><div class="bar-fill" id="dsBar" style="width:0"></div></div></div>
    <div class="stat green"><div class="sl">Remaining</div><div class="sv" id="dsRemain">â€”</div><div class="sc" id="dsPct" style="color:var(--ok)">â€”</div></div>
    <div class="stat blue"><div class="sl">Total Revenue</div><div class="sv" id="dsRevenue">â€”</div><div class="sc" style="color:var(--gc)">PHP</div></div>
    <div class="stat gold"><div class="sl">Total Transactions</div><div class="sv" id="dsTx">â€”</div></div>
    <div class="stat green"><div class="sl">Successful</div><div class="sv" id="dsSuccess">â€”</div></div>
    <div class="stat red"><div class="sl">Failed</div><div class="sv" id="dsFailed">â€”</div></div>
    <div class="stat blue"><div class="sl">Unique Buyers</div><div class="sv" id="dsBuyers">â€”</div></div>
    <div class="stat gold"><div class="sl">Today Sales</div><div class="sv" id="dsToday">â€”</div><div class="sc" id="dsTodayRev" style="color:var(--gold)">â€”</div></div>
  </div>
  <div class="tbl-wrap"><div class="tbl-head"><h3>ğŸ“¡ Recent Activity</h3><button class="btn-sm btn-blue" onclick="loadDashboard()">â†» Refresh</button></div><ul class="feed" id="feedList"><li class="tbl-empty">Loading...</li></ul></div>
</div>

<!-- Transactions -->
<div class="page" id="pg-transactions">
  <div class="page-title">Transactions</div><div class="page-sub">All purchase records</div>
  <div class="tbl-wrap">
    <div class="tbl-head"><h3>ğŸ“‹ Transaction Log</h3><div class="tbl-actions"><button class="btn-sm btn-green" onclick="exportData('transactions')">â¬‡ Export</button><button class="btn-sm btn-blue" onclick="loadTransactions()">â†» Refresh</button></div></div>
    <div style="overflow-x:auto"><table><thead><tr><th>Date</th><th>TX ID</th><th>Name</th><th>Phone</th><th>GCash Ref</th><th>Qty</th><th>Amount</th><th>Status</th><th>Action</th></tr></thead><tbody id="txBody"><tr><td colspan="9" class="tbl-empty">Loading...</td></tr></tbody></table></div>
    <div class="pagination" id="txPagination"></div>
  </div>
</div>

<!-- Numbers -->
<div class="page" id="pg-numbers">
  <div class="page-title">Sold Numbers</div><div class="page-sub">All assigned lottery numbers</div>
  <div class="tbl-wrap">
    <div class="tbl-head"><h3>ğŸ”¢ Number Registry</h3><div class="tbl-actions"><button class="btn-sm btn-green" onclick="exportData('sold')">â¬‡ Export</button><button class="btn-sm btn-blue" onclick="loadNumbers()">â†» Refresh</button></div></div>
    <div style="overflow-x:auto"><table><thead><tr><th>Number</th><th>TX ID</th><th>Name</th><th>Phone</th><th>GCash Ref</th><th>Date</th></tr></thead><tbody id="numBody"><tr><td colspan="6" class="tbl-empty">Loading...</td></tr></tbody></table></div>
    <div class="pagination" id="numPagination"></div>
  </div>
</div>

<!-- Search -->
<div class="page" id="pg-search">
  <div class="page-title">Search</div><div class="page-sub">Find numbers, buyers, or transactions</div>
  <div class="tool-card"><h3>ğŸ” Search by Number</h3><div class="tool-row"><div class="fg"><label>6-Digit Number</label><input id="searchNum" maxlength="6" placeholder="e.g. 042069"></div><button class="btn-sm btn-gold" onclick="searchNumber()" style="height:42px">Search</button></div></div>
  <div class="tool-card"><h3>ğŸ‘¤ Search by Buyer</h3><div class="tool-row"><div class="fg"><label>Name, Phone, TX ID, or GCash Ref</label><input id="searchBuyer" placeholder="e.g. Juan or 09171234567"></div><button class="btn-sm btn-gold" onclick="searchBuyerFn()" style="height:42px">Search</button></div></div>
  <div class="tbl-wrap" id="searchResults" style="display:none"><div class="tbl-head"><h3 id="searchTitle">Results</h3></div><div style="overflow-x:auto"><table><thead id="searchThead"></thead><tbody id="searchTbody"></tbody></table></div></div>
</div>

<!-- Tools -->
<div class="page" id="pg-tools">
  <div class="page-title">Tools</div><div class="page-sub">Manual operations and maintenance</div>
  <div class="tool-card"><h3>â• Add Number Manually</h3><div class="tool-row"><div class="fg"><label>Number</label><input id="addNum" maxlength="6" placeholder="e.g. 123456"></div><div class="fg"><label>Owner Name</label><input id="addName" placeholder="Name (optional)"></div><div class="fg"><label>Phone</label><input id="addPhone" maxlength="11" placeholder="Phone (optional)"></div><button class="btn-sm btn-green" onclick="addNumber()" style="height:42px">Add</button></div></div>
  <div class="tool-card"><h3>â– Remove Number</h3><div class="tool-row"><div class="fg"><label>Number to Remove</label><input id="removeNum" maxlength="6" placeholder="e.g. 123456"></div><button class="btn-sm btn-red" onclick="removeNumber()" style="height:42px">Remove</button></div></div>
  <div class="tool-card"><h3>ğŸ“¥ Export Data</h3><div style="display:flex;gap:10px;flex-wrap:wrap"><button class="btn-sm btn-green" onclick="exportData('sold')">â¬‡ Sold Numbers CSV</button><button class="btn-sm btn-blue" onclick="exportData('transactions')">â¬‡ Transactions CSV</button></div></div>
</div>

<!-- Settings -->
<div class="page" id="pg-settings">
  <div class="page-title">Settings</div><div class="page-sub">Configure lottery and account â€” saved in Admin sheet</div>
  <div class="settings-grid">
    <div class="setting-group"><h3>ğŸ’³ GCash Settings</h3><div class="fg"><label>GCash Name</label><input id="setGcashName" placeholder="Account name"></div><div class="fg"><label>GCash Number</label><input id="setGcashNum" placeholder="09XX-XXX-XXXX"></div></div>
    <div class="setting-group"><h3>ğŸ° Lottery Settings</h3><div class="fg"><label>Lottery Name</label><input id="setLotteryName" placeholder="LUCKY 6 LOTTERY"></div><div class="fg"><label>Draw Date</label><input id="setDrawDate" type="date"></div></div>
    <div class="setting-group"><h3>ğŸ”¢ Purchase Limits</h3><div class="fg"><label>Price per Number (â‚±)</label><input id="setPrice" type="number" min="1"></div><div class="fg"><label>Min Quantity</label><input id="setMinQty" type="number" min="1"></div><div class="fg"><label>Max Quantity</label><input id="setMaxQty" type="number" min="1"></div></div>
    <div class="setting-group"><h3>ğŸ“¢ Announcement</h3><div class="fg"><label>Message (shown to buyers)</label><textarea id="setAnnouncement" placeholder="Optional announcement text"></textarea></div><div class="fg"><label>Maintenance Mode</label><select id="setMaintenance"><option value="false">Disabled</option><option value="true">Enabled â€” Blocks purchases</option></select></div></div>
  </div>
  <div class="setting-group"><h3>ğŸ” Change Password</h3><div class="settings-grid"><div class="fg"><label>New Password</label><input id="setNewPass" type="password" placeholder="Min 6 characters"><small>Leave blank to keep current password.</small></div><div class="fg"><label>Confirm Password</label><input id="setNewPass2" type="password" placeholder="Repeat new password"></div></div></div>
  <button class="btn b1" onclick="saveSettings()" style="max-width:300px">ğŸ’¾ Save All Settings</button>
</div>

</div><!-- /content -->
</div><!-- /admain -->
</div><!-- /adminPanel -->
</div><!-- /adminPage -->


<script>
// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  â˜…â˜…â˜…  CONFIGURE THESE VALUES  â˜…â˜…â˜…                            â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SCRIPT_URL    = 'https://script.google.com/macros/s/AKfycbzqUN38QtkAnrAXeRHiLxgP4MV6YGfHI7GOz-XosAUlpa8-N8QmH45hkId8Ny6L5nEOrg/exec';
const GCASH_NUMBER  = '0917-123-4567';
const GCASH_NAME    = 'Juan Dela Cruz';

// â˜… SECRET KEY â€” change this to your own secret word
const ADMIN_SECRET  = 'admin2025';
// Access admin via: yourpage.html?access=admin2025
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const MIN_QTY=50,MAX_QTY=10000,MAX_RETRY=3,RETRY_MS=[3000,5000,8000],FETCH_TIMEOUT=120000,TOTAL_POOL=1000000;
let myNums=[],serverOnline=false,TOKEN='',currentPage={tx:1,num:1};
let IS_ADMIN_MODE=false;

function pad6(n){return String(n).padStart(6,'0').substring(0,6);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â˜… ROUTE DETECTION â€” decides public vs admin on page load
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function detectMode(){
  const params=new URLSearchParams(window.location.search);
  const access=params.get('access');
  if(access===ADMIN_SECRET){
    IS_ADMIN_MODE=true;
    document.getElementById('publicPage').style.display='none';
    document.getElementById('adminPage').style.display='block';
    document.title='Lucky 6 â€” Admin Panel';
  } else {
    IS_ADMIN_MODE=false;
    document.getElementById('publicPage').style.display='block';
    document.getElementById('adminPage').style.display='none';
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHARED HELPERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toast(m,t){const e=document.getElementById('toast');e.textContent=m;e.className='toast '+t+' on';clearTimeout(e._t);e._t=setTimeout(()=>e.classList.remove('on'),5000);}
function showOv(t,s){document.getElementById('ovT').textContent=t||'Processing...';document.getElementById('ovS').textContent=s||'Please wait';document.getElementById('ov').classList.add('on');}
function hideOv(){document.getElementById('ov').classList.remove('on');}
function closeConfirm(){document.getElementById('confirmModal').classList.remove('on');}
function show(id){document.getElementById(id).classList.remove('hide');}
function hide(id){document.getElementById(id).classList.add('hide');}

async function safeFetch(url,timeoutMs){
  const c=new AbortController();const t=setTimeout(()=>c.abort(),timeoutMs||FETCH_TIMEOUT);
  try{const r=await fetch(url,{method:'GET',redirect:'follow',signal:c.signal});clearTimeout(t);const txt=await r.text();
    if(txt.trim().startsWith('<!DOCTYPE')||txt.trim().startsWith('<html')||txt.trim().startsWith('<HTML')){if(txt.includes('accounts.google.com'))throw new Error('AUTH_ERROR');throw new Error('HTML_RESPONSE');}
    try{return JSON.parse(txt);}catch(e){const m=txt.match(/\{[\s\S]*\}/);if(m)return JSON.parse(m[0]);throw new Error('PARSE_ERROR');}
  }catch(err){clearTimeout(t);if(err.name==='AbortError')throw new Error('TIMEOUT');throw err;}
}

function getFriendlyError(err){
  const m=err.message||String(err);
  if(m==='AUTH_ERROR')return{short:'Script not deployed as "Anyone".',detail:'<p>Set "Who has access" to <code>Anyone</code>.</p><button class="retry-btn" onclick="checkConnection()">ğŸ”„ Retry</button>'};
  if(m==='HTML_RESPONSE')return{short:'Wrong URL or script error.',detail:'<p>URL must end with <code>/exec</code>.</p><button class="retry-btn" onclick="checkConnection()">ğŸ”„ Retry</button>'};
  if(m==='PARSE_ERROR')return{short:'Invalid server response.',detail:'<p>Re-deploy the script.</p><button class="retry-btn" onclick="checkConnection()">ğŸ”„ Retry</button>'};
  if(m==='TIMEOUT')return{short:'Server timed out.',detail:'<p>Try again.</p><button class="retry-btn" onclick="checkConnection()">ğŸ”„ Retry</button>'};
  if(m.includes('Failed to fetch')||m.includes('NetworkError')||m.includes('network'))return{short:'Cannot reach server.',detail:'<p>Check internet.</p><button class="retry-btn" onclick="checkConnection()">ğŸ”„ Retry</button>'};
  return{short:m,detail:'<p>'+m+'</p><button class="retry-btn" onclick="checkConnection()">ğŸ”„ Retry</button>'};
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PUBLIC PAGE FUNCTIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function titleCase(s){return s.replace(/\b\w/g,c=>c.toUpperCase());}
function getDigitsOnly(s){return s.replace(/\D/g,'');}
function isValidPhone(s){return getDigitsOnly(s).length===11;}

function updatePhoneStatus(){
  const raw=document.getElementById('fP').value;const d=getDigitsOnly(raw);
  const err=document.getElementById('phoneErr'),inp=document.getElementById('fP');
  if(raw===''){err.style.display='none';inp.style.borderColor='rgba(255,255,255,.1)';return;}
  if(d.length===11){err.style.display='none';inp.style.borderColor='var(--ok)';}
  else{err.style.display='block';err.textContent='Phone must be 11 digits ('+d.length+'/11)';inp.style.borderColor=d.length>0?'var(--err)':'rgba(255,255,255,.1)';}
}

function setTodayDate(){document.getElementById('dateToday').textContent=new Date().toLocaleDateString('en-PH',{weekday:'long',year:'numeric',month:'long',day:'numeric'});}

function updateProgress(sold,remaining){
  const pct=Math.max(0,Math.min(100,(remaining/TOTAL_POOL)*100));
  const f=document.getElementById('progressFill'),t=document.getElementById('availTxt');
  f.style.width=pct+'%';f.classList.remove('mid','low');t.classList.remove('high','mid','low');
  if(pct>60){t.textContent='Plenty available';t.classList.add('high');}
  else if(pct>30){t.textContent='Selling fast';t.classList.add('mid');f.classList.add('mid');}
  else if(pct>10){t.textContent='Running low';t.classList.add('low');f.classList.add('low');}
  else if(pct>0){t.textContent='Almost sold out!';t.classList.add('low');f.classList.add('low');}
  else{t.textContent='Sold out';t.classList.add('low');f.classList.add('low');}
}

async function checkConnection(){
  const bar=document.getElementById('connBar'),txt=document.getElementById('connTxt'),errP=document.getElementById('errPanel');
  bar.className='conn checking';txt.textContent='Checking server connection...';errP.classList.add('hide');
  if(SCRIPT_URL.includes('YOUR_')){bar.className='conn offline';txt.textContent='Not configured â€” set SCRIPT_URL';document.getElementById('errDetail').innerHTML='<p>Set <code>SCRIPT_URL</code>.</p>';errP.classList.remove('hide');return;}
  try{const d=await safeFetch(SCRIPT_URL+'?action=health',15000);if(d.success){serverOnline=true;bar.className='conn online';txt.textContent='âœ“ Connected â€” ready';loadPublicStats();}else throw new Error(d.error||'Health check failed');}
  catch(err){serverOnline=false;bar.className='conn offline';const f=getFriendlyError(err);txt.textContent='âœ— '+f.short;document.getElementById('errDetail').innerHTML=f.detail;errP.classList.remove('hide');}
}

async function loadPublicStats(){try{const d=await safeFetch(SCRIPT_URL+'?action=stats',15000);if(d.success)updateProgress(d.sold,d.remaining);}catch(e){}}

function calc(){const v=Math.min(MAX_QTY,Math.max(0,parseInt(document.getElementById('fQ').value)||0));document.getElementById('dT').textContent='â‚± '+v.toLocaleString()+'.00';}

function go2(){
  const nm=document.getElementById('fN').value.trim(),ph=document.getElementById('fP').value.trim(),qt=parseInt(document.getElementById('fQ').value);
  if(!nm)return toast('Please enter your full name.','err');
  if(!isValidPhone(ph))return toast('Phone must be exactly 11 digits ('+getDigitsOnly(ph).length+'/11).','err');
  if(!qt||qt<MIN_QTY){document.getElementById('fQ').value=MIN_QTY;calc();return toast('Minimum quantity is '+MIN_QTY+'.','err');}
  if(qt>MAX_QTY){document.getElementById('fQ').value=MAX_QTY;calc();return toast('Maximum '+MAX_QTY.toLocaleString()+' per transaction.','err');}
  hide('p1');show('p2');document.getElementById('dA').textContent=' â‚± '+qt.toLocaleString()+'.00';stpSet(2);
}
function go1(){hide('p2');show('p1');stpSet(1);}
function stpSet(n){const c=(id,cl)=>document.getElementById(id).className=cl;c('i1',n===1?'stp on':'stp ok');c('i2',n===2?'stp on':n>2?'stp ok':'stp');c('i3',n===3?'stp on':'stp');c('l1',n>=2?'sln on':'sln');c('l2',n>=3?'sln on':'sln');}

function submitPurchase(){
  const ref=document.getElementById('fR').value.trim();if(!ref)return toast('Enter your GCash reference number.','err');
  if(!serverOnline){toast('Server offline.','err');checkConnection();return;}
  const nm=document.getElementById('fN').value.trim(),ph=document.getElementById('fP').value.trim(),qt=parseInt(document.getElementById('fQ').value);
  document.getElementById('buyBtn').disabled=true;attemptPurchase(nm,ph,qt,ref,0);
}

async function attemptPurchase(nm,ph,qt,ref,tryN){
  const rb=document.getElementById('rb'),rf=document.getElementById('rf');
  if(tryN===0){showOv('Generating '+qt.toLocaleString()+' unique numbers...','Verifying uniqueness and saving');rb.style.display='none';}
  else{showOv('â³ Retry '+tryN+' of '+MAX_RETRY,'Server busy. Retrying...');rb.style.display='block';rf.style.transition='none';rf.style.width='0%';setTimeout(()=>{rf.style.transition='width '+(RETRY_MS[tryN-1]/1000)+'s linear';rf.style.width='100%';},50);}
  if(tryN>0)await new Promise(r=>setTimeout(r,RETRY_MS[tryN-1]));
  const params=new URLSearchParams({action:'purchase',quantity:qt,name:nm,phone:ph,gcashRef:ref});
  try{
    const d=await safeFetch(SCRIPT_URL+'?'+params.toString(),FETCH_TIMEOUT);
    if(d.success){hideOv();document.getElementById('buyBtn').disabled=false;myNums=d.numbers.map(n=>pad6(n));showResult(d,nm,ph,qt,ref);loadPublicStats();toast('ğŸ‰ '+d.quantity.toLocaleString()+' unique numbers generated!','suc');}
    else if(d.retryable&&tryN<MAX_RETRY){toast('â³ Busy â€” retrying...','warn');attemptPurchase(nm,ph,qt,ref,tryN+1);}
    else{hideOv();document.getElementById('buyBtn').disabled=false;toast(d.error||'Purchase failed.','err');}
  }catch(err){
    if(tryN<MAX_RETRY){toast('âš ï¸ Retrying...','warn');attemptPurchase(nm,ph,qt,ref,tryN+1);}
    else{hideOv();document.getElementById('buyBtn').disabled=false;toast(getFriendlyError(err).short,'err');}
  }
}

function showResult(d,nm,ph,qt,ref){
  hide('secB');show('secR');stpSet(3);
  document.getElementById('rI').textContent=d.transactionId;document.getElementById('rD').textContent=d.timestamp||new Date().toLocaleString('en-PH',{timeZone:'Asia/Manila'});
  document.getElementById('rN').textContent=nm;document.getElementById('rP').textContent=ph;
  document.getElementById('rQ').textContent=d.quantity.toLocaleString()+' numbers';document.getElementById('rA').textContent='â‚± '+d.amount.toLocaleString()+'.00';
  document.getElementById('rR').textContent=ref;document.getElementById('rC').textContent=myNums.length.toLocaleString();
  const g=document.getElementById('nG');let h='';for(let i=0;i<myNums.length;i++)h+='<div class="ni">'+myNums[i]+'</div>';g.innerHTML=h;
  window.scrollTo({top:0,behavior:'smooth'});
}

function cpA(){const t=myNums.join('\n');navigator.clipboard.writeText(t).then(()=>toast('Copied!','suc')).catch(()=>{const a=document.createElement('textarea');a.value=t;document.body.appendChild(a);a.select();document.execCommand('copy');document.body.removeChild(a);toast('Copied!','suc');});}
function dlA(){
  const tx=document.getElementById('rI').textContent;const L=['â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•','   LUCKY 6 LOTTERY â€” YOUR NUMBERS','â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•','','Transaction : '+tx,'Date        : '+document.getElementById('rD').textContent,'Name        : '+document.getElementById('rN').textContent,'Phone       : '+document.getElementById('rP').textContent,'Quantity    : '+myNums.length.toLocaleString(),'Amount      : â‚±'+myNums.length.toLocaleString()+'.00','GCash Ref   : '+document.getElementById('rR').textContent,'','â”€â”€ 6-DIGIT NUMBERS â”€â”€',''];
  for(let i=0;i<myNums.length;i++)L.push(myNums[i]);const b=new Blob([L.join('\n')],{type:'text/plain'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='Lucky6-'+tx+'.txt';a.click();URL.revokeObjectURL(a.href);toast('Download started!','suc');
}
function prA(){
  const w=window.open('','_blank');w.document.write('<!DOCTYPE html><html><head><title>Lucky 6</title><style>body{font-family:monospace;padding:20px;font-size:12px}h1{text-align:center;font-size:20px}.s{text-align:center;color:#666;margin-bottom:14px;font-size:11px}.i{border:1px solid #ccc;padding:10px;border-radius:6px;margin-bottom:14px;line-height:2}.g{display:grid;grid-template-columns:repeat(6,1fr);gap:3px}.n{border:1px solid #ddd;padding:5px;text-align:center;font-weight:bold;letter-spacing:2px;font-size:12px}</style></head><body><h1>ğŸ° LUCKY 6 LOTTERY</h1><div class="s">000000â€“999999 â€¢ â‚±1.00/number</div><div class="i"><b>TX:</b> '+document.getElementById('rI').textContent+' <b>Date:</b> '+document.getElementById('rD').textContent+'<br><b>Name:</b> '+document.getElementById('rN').textContent+' <b>Phone:</b> '+document.getElementById('rP').textContent+'<br><b>Qty:</b> '+myNums.length.toLocaleString()+' <b>Amt:</b> â‚±'+myNums.length.toLocaleString()+'.00</div><div class="g">'+myNums.map(n=>'<div class="n">'+n+'</div>').join('')+'</div></body></html>');
  w.document.close();setTimeout(()=>w.print(),300);
}
function cpGC(){navigator.clipboard.writeText(GCASH_NUMBER.replace(/\D/g,'')).then(()=>toast('GCash # copied!','suc')).catch(()=>{});}

function again(){
  hide('secR');show('secB');['fN','fP','fQ','fR'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('dT').textContent='â‚± 0.00';document.getElementById('phoneErr').style.display='none';
  document.getElementById('fP').style.borderColor='rgba(255,255,255,.1)';hide('p2');show('p1');stpSet(1);
  document.getElementById('errPanel').classList.add('hide');myNums=[];window.scrollTo({top:0,behavior:'smooth'});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN FUNCTIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function adminApi(action,params){
  params=params||{};params.action=action;params.token=TOKEN;
  const url=SCRIPT_URL+'?'+new URLSearchParams(params).toString();
  const c=new AbortController();const t=setTimeout(()=>c.abort(),60000);
  try{const r=await fetch(url,{signal:c.signal,redirect:'follow'});clearTimeout(t);const txt=await r.text();try{return JSON.parse(txt);}catch(e){const m=txt.match(/\{[\s\S]*\}/);if(m)return JSON.parse(m[0]);throw new Error('Parse error');}}
  catch(err){clearTimeout(t);if(err.name==='AbortError')throw new Error('Timeout');throw err;}
}

async function doLogin(){
  const u=document.getElementById('loginUser').value.trim(),p=document.getElementById('loginPass').value.trim();
  if(!u||!p)return toast('Enter username and password.','err');
  document.getElementById('loginBtn').disabled=true;showOv('Signing in...','');
  try{const d=await adminApi('adminLogin',{username:u,password:p});
    if(d.success){TOKEN=d.token;localStorage.setItem('lk6_token',TOKEN);localStorage.setItem('lk6_user',u);document.getElementById('adminUser').textContent=u;document.getElementById('adminLogin').style.display='none';document.getElementById('adminPanel').style.display='block';loadDashboard();toast('Welcome, '+u+'!','suc');}
    else toast(d.error||'Login failed.','err');
  }catch(e){toast('Connection error: '+e.message,'err');}
  hideOv();document.getElementById('loginBtn').disabled=false;
}

function doLogout(){TOKEN='';localStorage.removeItem('lk6_token');localStorage.removeItem('lk6_user');document.getElementById('adminPanel').style.display='none';document.getElementById('adminLogin').style.display='flex';document.getElementById('loginPass').value='';toast('Logged out.','warn');}

function goPage(name){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById('pg-'+name).classList.add('active');
  document.querySelectorAll('.sidebar .nav-item').forEach(n=>n.classList.remove('active'));document.querySelectorAll('.sidebar .nav-item[data-page="'+name+'"]').forEach(n=>n.classList.add('active'));
  document.querySelectorAll('.mob-nav .nav-item').forEach(n=>{n.classList.remove('active');if(n.textContent.toLowerCase().includes(name.substring(0,4)))n.classList.add('active');});
  if(name==='dashboard')loadDashboard();if(name==='transactions')loadTransactions();if(name==='numbers')loadNumbers();if(name==='settings')loadSettingsFn();
}

async function loadDashboard(){
  try{const d=await adminApi('adminDashboard');if(d.success)populateDashboard(d);else toast(d.error,'err');}catch(e){toast('Error loading dashboard','err');}
  loadRecentActivity();
}

function populateDashboard(d){
  document.getElementById('dsSold').textContent=d.totalSold.toLocaleString();document.getElementById('dsRemain').textContent=d.remaining.toLocaleString();
  document.getElementById('dsPct').textContent=d.percentSold+'% sold';document.getElementById('dsRevenue').textContent='â‚±'+d.totalRevenue.toLocaleString();
  document.getElementById('dsTx').textContent=d.totalTransactions.toLocaleString();document.getElementById('dsSuccess').textContent=d.successTransactions.toLocaleString();
  document.getElementById('dsFailed').textContent=d.failedTransactions.toLocaleString();document.getElementById('dsBuyers').textContent=d.uniqueBuyers.toLocaleString();
  document.getElementById('dsToday').textContent=d.todayTransactions.toLocaleString();document.getElementById('dsTodayRev').textContent='â‚±'+d.todayRevenue.toLocaleString();
  const pct=d.totalSold/d.totalPool*100;const bar=document.getElementById('dsBar');bar.style.width=pct+'%';bar.classList.remove('mid','low');if(pct>70)bar.classList.add('low');else if(pct>40)bar.classList.add('mid');
}

async function loadRecentActivity(){
  try{const d=await adminApi('adminRecentActivity',{limit:15});if(!d.success)return;const list=document.getElementById('feedList');
    if(!d.activities.length){list.innerHTML='<li class="tbl-empty">No activity yet.</li>';return;}
    let h='';d.activities.forEach(a=>{const dc=a.status==='SUCCESS'?'ok':a.status==='DELETED'?'del':'fail';h+='<li><div class="dot '+dc+'"></div><div style="flex:1"><strong>'+a.name+'</strong> â€” '+a.quantity+' numbers (â‚±'+Number(a.amount).toLocaleString()+')<br><span class="time">'+a.timestamp+' â€¢ '+a.transactionId+'</span></div><span class="badge '+(a.status==='SUCCESS'?'ok':a.status==='DELETED'?'del':'fail')+'">'+a.status+'</span></li>';});
    list.innerHTML=h;
  }catch(e){}
}

async function loadTransactions(page){
  currentPage.tx=page||1;showOv('Loading transactions...','');
  try{const d=await adminApi('adminTransactions',{page:currentPage.tx,perPage:30});hideOv();if(!d.success)return toast(d.error,'err');
    const body=document.getElementById('txBody');if(!d.transactions.length){body.innerHTML='<tr><td colspan="9" class="tbl-empty">No transactions.</td></tr>';document.getElementById('txPagination').innerHTML='';return;}
    let h='';d.transactions.forEach(t=>{const sc=t.status==='SUCCESS'?'ok':t.status==='DELETED'?'del':'fail';h+='<tr><td>'+t.timestamp+'</td><td class="mono" style="font-size:.75rem">'+t.transactionId+'</td><td>'+t.name+'</td><td>'+t.phone+'</td><td>'+t.gcashRef+'</td><td>'+t.quantity+'</td><td>â‚±'+Number(t.amount).toLocaleString()+'</td><td><span class="badge '+sc+'">'+t.status+'</span></td><td>'+(t.status==='SUCCESS'?'<button class="btn-sm btn-red" onclick="confirmDelete(\''+t.transactionId+'\')">Delete</button>':'â€”')+'</td></tr>';});
    body.innerHTML=h;renderPagination('txPagination',d.page,d.totalPages,'loadTransactions');
  }catch(e){hideOv();toast('Error','err');}
}

async function loadNumbers(page){
  currentPage.num=page||1;showOv('Loading numbers...','');
  try{const d=await adminApi('adminSoldNumbers',{page:currentPage.num,perPage:100});hideOv();if(!d.success)return toast(d.error,'err');
    const body=document.getElementById('numBody');if(!d.numbers.length){body.innerHTML='<tr><td colspan="6" class="tbl-empty">No numbers sold.</td></tr>';document.getElementById('numPagination').innerHTML='';return;}
    let h='';d.numbers.forEach(n=>{h+='<tr><td class="mono">'+n.number+'</td><td style="font-size:.75rem">'+n.transactionId+'</td><td>'+n.name+'</td><td>'+n.phone+'</td><td>'+n.gcashRef+'</td><td>'+n.timestamp+'</td></tr>';});
    body.innerHTML=h;renderPagination('numPagination',d.page,d.totalPages,'loadNumbers');
  }catch(e){hideOv();toast('Error','err');}
}

function renderPagination(cid,cur,total,fn){
  const c=document.getElementById(cid);if(total<=1){c.innerHTML='';return;}
  let h='<button class="pg-btn" onclick="'+fn+'('+(cur-1)+')" '+(cur<=1?'disabled':'')+'>â† Prev</button>';
  const s=Math.max(1,cur-2),e=Math.min(total,cur+2);
  if(s>1)h+='<button class="pg-btn" onclick="'+fn+'(1)">1</button>';if(s>2)h+='<span class="pg-info">...</span>';
  for(let i=s;i<=e;i++)h+='<button class="pg-btn'+(i===cur?' active':'')+'" onclick="'+fn+'('+i+')">'+i+'</button>';
  if(e<total-1)h+='<span class="pg-info">...</span>';if(e<total)h+='<button class="pg-btn" onclick="'+fn+'('+total+')">'+total+'</button>';
  h+='<button class="pg-btn" onclick="'+fn+'('+(cur+1)+')" '+(cur>=total?'disabled':'')+'>Next â†’</button><span class="pg-info" style="margin-left:8px">Page '+cur+'/'+total+'</span>';
  c.innerHTML=h;
}

function confirmDelete(txId){
  document.getElementById('confirmTitle').textContent='âš ï¸ Delete Transaction?';
  document.getElementById('confirmMsg').innerHTML='Permanently remove <code>'+txId+'</code> and all its numbers?<br><br><strong>Cannot be undone.</strong>';
  document.getElementById('confirmYes').textContent='Yes, Delete';document.getElementById('confirmYes').onclick=()=>doDeleteTx(txId);document.getElementById('confirmModal').classList.add('on');
}
async function doDeleteTx(txId){closeConfirm();showOv('Deleting...','');try{const d=await adminApi('adminDeleteTransaction',{transactionId:txId});hideOv();if(d.success){toast(d.message,'suc');loadTransactions(currentPage.tx);loadDashboard();}else toast(d.error,'err');}catch(e){hideOv();toast('Delete failed','err');}}

async function searchNumber(){
  const q=document.getElementById('searchNum').value.trim();if(!q)return toast('Enter a number.','err');showOv('Searching...','');
  try{const d=await adminApi('adminSearchNumber',{query:q});hideOv();const w=document.getElementById('searchResults');w.style.display='block';
    document.getElementById('searchTitle').textContent=d.found?'âœ… Number '+d.query+' found':'âŒ Number '+d.query+' not found';
    if(d.found){document.getElementById('searchThead').innerHTML='<tr><th>Number</th><th>TX ID</th><th>Name</th><th>Phone</th><th>GCash Ref</th><th>Date</th></tr>';let h='';d.results.forEach(r=>{h+='<tr><td class="mono">'+r.number+'</td><td style="font-size:.75rem">'+r.transactionId+'</td><td>'+r.name+'</td><td>'+r.phone+'</td><td>'+r.gcashRef+'</td><td>'+r.timestamp+'</td></tr>';});document.getElementById('searchTbody').innerHTML=h;}
    else{document.getElementById('searchThead').innerHTML='';document.getElementById('searchTbody').innerHTML='<tr><td class="tbl-empty">Number not sold yet.</td></tr>';}
  }catch(e){hideOv();toast('Search error','err');}
}

async function searchBuyerFn(){
  const q=document.getElementById('searchBuyer').value.trim();if(!q)return toast('Enter search term.','err');showOv('Searching...','');
  try{const d=await adminApi('adminSearchBuyer',{query:q});hideOv();const w=document.getElementById('searchResults');w.style.display='block';
    document.getElementById('searchTitle').textContent=d.total+' result(s) for "'+q+'"';
    if(d.total>0){document.getElementById('searchThead').innerHTML='<tr><th>Date</th><th>TX ID</th><th>Name</th><th>Phone</th><th>GCash</th><th>Qty</th><th>Amount</th><th>Status</th></tr>';let h='';d.results.forEach(r=>{const sc=r.status==='SUCCESS'?'ok':r.status==='DELETED'?'del':'fail';h+='<tr><td>'+r.timestamp+'</td><td style="font-size:.75rem">'+r.transactionId+'</td><td>'+r.name+'</td><td>'+r.phone+'</td><td>'+r.gcashRef+'</td><td>'+r.quantity+'</td><td>â‚±'+Number(r.amount).toLocaleString()+'</td><td><span class="badge '+sc+'">'+r.status+'</span></td></tr>';});document.getElementById('searchTbody').innerHTML=h;}
    else{document.getElementById('searchThead').innerHTML='';document.getElementById('searchTbody').innerHTML='<tr><td class="tbl-empty">No records found.</td></tr>';}
  }catch(e){hideOv();toast('Search error','err');}
}

async function addNumber(){
  const num=document.getElementById('addNum').value.trim();if(!num||num.length>6)return toast('Enter valid number.','err');
  const name=document.getElementById('addName').value.trim()||'ADMIN',phone=document.getElementById('addPhone').value.trim()||'N/A';
  showOv('Adding...','');
  try{const d=await adminApi('adminAddNumber',{number:num,name:name,phone:phone});hideOv();if(d.success){toast(d.message,'suc');document.getElementById('addNum').value='';document.getElementById('addName').value='';document.getElementById('addPhone').value='';}else toast(d.error,'err');}
  catch(e){hideOv();toast('Error','err');}
}

async function removeNumber(){
  const num=document.getElementById('removeNum').value.trim();if(!num)return toast('Enter a number.','err');
  document.getElementById('confirmTitle').textContent='âš ï¸ Remove Number?';
  document.getElementById('confirmMsg').innerHTML='Remove <code>'+num.padStart(6,'0')+'</code>?';
  document.getElementById('confirmYes').textContent='Yes, Remove';
  document.getElementById('confirmYes').onclick=async()=>{closeConfirm();showOv('Removing...','');
    try{const d=await adminApi('adminRemoveNumber',{number:num});hideOv();if(d.success){toast(d.message,'suc');document.getElementById('removeNum').value='';}else toast(d.error,'err');}catch(e){hideOv();toast('Error','err');}};
  document.getElementById('confirmModal').classList.add('on');
}

async function loadSettingsFn(){
  showOv('Loading settings...','');
  try{const d=await adminApi('adminGetSettings');hideOv();if(!d.success)return toast(d.error,'err');const s=d.settings;
    document.getElementById('setGcashName').value=s.gcash_name||'';document.getElementById('setGcashNum').value=s.gcash_number||'';
    document.getElementById('setLotteryName').value=s.lottery_name||'';document.getElementById('setDrawDate').value=s.draw_date||'';
    document.getElementById('setPrice').value=s.price_per_number||'1';document.getElementById('setMinQty').value=s.min_quantity||'50';
    document.getElementById('setMaxQty').value=s.max_quantity||'10000';document.getElementById('setAnnouncement').value=s.announcement||'';
    document.getElementById('setMaintenance').value=s.maintenance_mode||'false';
  }catch(e){hideOv();toast('Error loading settings','err');}
}

async function saveSettings(){
  const np=document.getElementById('setNewPass').value,np2=document.getElementById('setNewPass2').value;
  if(np&&np.length<6)return toast('Password min 6 characters.','err');if(np&&np!==np2)return toast('Passwords do not match.','err');
  showOv('Saving...','');
  const params={gcash_name:document.getElementById('setGcashName').value.trim(),gcash_number:document.getElementById('setGcashNum').value.trim(),lottery_name:document.getElementById('setLotteryName').value.trim(),draw_date:document.getElementById('setDrawDate').value,price_per_number:document.getElementById('setPrice').value,min_quantity:document.getElementById('setMinQty').value,max_quantity:document.getElementById('setMaxQty').value,announcement:document.getElementById('setAnnouncement').value.trim(),maintenance_mode:document.getElementById('setMaintenance').value};
  if(np)params.new_password=np;
  try{const d=await adminApi('adminUpdateSettings',params);hideOv();if(d.success){toast('âœ… '+d.message,'suc');document.getElementById('setNewPass').value='';document.getElementById('setNewPass2').value='';if(np){toast('Password changed. Log in again.','warn');setTimeout(doLogout,2000);}}else toast(d.error,'err');}
  catch(e){hideOv();toast('Save error','err');}
}

async function exportData(type){
  showOv('Exporting...','');
  try{const d=await adminApi('adminExportData',{type:type});hideOv();if(!d.success)return toast(d.error,'err');
    let csv=d.headers.join(',')+'\n';d.data.forEach(row=>{csv+=row.map(cell=>'"'+String(cell).replace(/"/g,'""')+'"').join(',')+'\n';});
    const blob=new Blob([csv],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='Lucky6-'+type+'-'+new Date().toISOString().slice(0,10)+'.csv';a.click();URL.revokeObjectURL(a.href);
    toast('Exported '+(d.total||0).toLocaleString()+' rows!','suc');
  }catch(e){hideOv();toast('Export error','err');}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â˜… INIT â€” Detects mode and starts the right page
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('DOMContentLoaded',async()=>{
  detectMode();

  if(IS_ADMIN_MODE){
    // ADMIN MODE
    const saved=localStorage.getItem('lk6_token'),user=localStorage.getItem('lk6_user');
    if(saved&&user){
      TOKEN=saved;showOv('Restoring session...','');
      try{const d=await adminApi('adminDashboard');if(d.success){document.getElementById('adminUser').textContent=user;document.getElementById('adminLogin').style.display='none';document.getElementById('adminPanel').style.display='block';populateDashboard(d);loadRecentActivity();}else doLogout();}catch(e){doLogout();}
      hideOv();
    }
    document.getElementById('loginPass').addEventListener('keydown',e=>{if(e.key==='Enter')doLogin();});
    document.getElementById('loginUser').addEventListener('keydown',e=>{if(e.key==='Enter')document.getElementById('loginPass').focus();});
  } else {
    // PUBLIC MODE
    setTodayDate();
    document.getElementById('dP').textContent=GCASH_NUMBER;document.getElementById('dN').textContent=GCASH_NAME;

    const nameInput=document.getElementById('fN');
    nameInput.addEventListener('input',()=>{const pos=nameInput.selectionStart;nameInput.value=titleCase(nameInput.value);nameInput.setSelectionRange(pos,pos);});

    const phoneInput=document.getElementById('fP');
    phoneInput.addEventListener('input',()=>{phoneInput.value=getDigitsOnly(phoneInput.value).substring(0,11);updatePhoneStatus();});
    phoneInput.addEventListener('blur',updatePhoneStatus);

    const qtyInput=document.getElementById('fQ');
    qtyInput.addEventListener('input',calc);
    qtyInput.addEventListener('focus',()=>{qtyInput.value='';calc();});
    qtyInput.addEventListener('blur',()=>{let v=parseInt(qtyInput.value);if(isNaN(v)||v<MIN_QTY){if(qtyInput.value!==''){qtyInput.value=MIN_QTY;toast('Minimum quantity is '+MIN_QTY,'warn');}}if(v>MAX_QTY){qtyInput.value=MAX_QTY;toast('Maximum '+MAX_QTY.toLocaleString(),'warn');}calc();});

    checkConnection();
    setInterval(setTodayDate,60000);
  }
});
</script>
</body>
</html>